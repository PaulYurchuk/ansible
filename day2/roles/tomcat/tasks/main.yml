- name: Does tomcat group exist?
  group: 
     name: '{{tomcat_group}}'
     state: present

- name: Does tomcat user exist?
  user: 
     name: '{{tomcat_user}}'
     group: '{{tomcat_group}}'
     state: present

- name: Creating the CATALINA_HOME folder...
  file: 
      path: '{{tomcat_home}}' 
      state: directory
      recurse: yes

- name: Downloading Tomcat server...
  get_url: 
     url: '{{tomcat_url}}'
     dest: /home/vagrant/apache-tomcat-{{tomcat_version}}.{{tomcat_subversion}}.tar.gz 
     force: no

- name: Unarchiving...
  unarchive: 
     src: /home/vagrant/apache-tomcat-{{tomcat_version}}.{{tomcat_subversion}}.tar.gz 
     dest: /home/vagrant/
     remote_src: yes
     creates: /home/vagrant/apache-tomcat-{{tomcat_version}}.{{tomcat_subversion}}
  notify:
    - copy file 

- name: force  notify copy file
  meta: flush_handlers

- name: Copy tomcat unit-file
  template: src=tomcat.service.j2 dest=/etc/systemd/system/tomcat.service

- service: 
      name: tomcat
      enabled: yes
      state: started
